<html>
    <head>
        <title>
            Hello world
        </title>
        <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.34/dist/web3.min.js"></script>
    </head>
    <body>
        Hello world
        <div id="error">
            You don't have metamask on your browser ! Install it before continuing.
        </div>
        <div id="body">
            
        </div>

        <script>
            (async () => {
                document.getElementById("body").hidden = true
                document.getElementById("error").hidden = true

                if (typeof window.ethereum === 'undefined') {
                    console.log('MetaMask is not installed !')
                    document.getElementById("body").hidden = true
                    document.getElementById("error").hidden = false
                    return
                }

                document.getElementById("body").hidden = false
                document.getElementById("error").hidden = true

                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' })

                const web3 = new Web3(window.web3.currentProvider)

                const {
                    BACKEND_HOST
                    , WEATHER_CONTRACT_ADDRESS
                    , DIAMOND_CONTRACT_ADDRESS
                    , EXCLUSIVE_CONTRACT_ADDRESS
                    , NETWORK_ID
                } = (await fetch('/runTimeVars')).json()

                console.log(`Fetched run time vars !`)

                const abi = (await fetch('/abi.json')).json()

                console.log(`Fetched ABI !`)

                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: `0x${NETWORK_ID}`}],
                })

                const ERC721Contract = new web3.eth.Contract(abi, DIAMOND_CONTRACT_ADDRESS)
                console.log(ERC721Contract)
            })()
        </script>        
    </body>
</html>